{
  "version": 3,
  "sources": ["../../../src/links/claim.ts"],
  "sourcesContent": ["// Copyright (c) Mysten Labs, Inc.\n// SPDX-License-Identifier: Apache-2.0\n\nimport type { PureArg } from '@mysten/sui.js/bcs';\nimport { bcs } from '@mysten/sui.js/bcs';\nimport { getFullnodeUrl, SuiClient } from '@mysten/sui.js/client';\nimport type {\n\tCoinStruct,\n\tSuiObjectData,\n\tSuiTransaction,\n\tSuiTransactionBlockResponse,\n} from '@mysten/sui.js/client';\nimport type { Keypair } from '@mysten/sui.js/cryptography';\nimport { Ed25519Keypair } from '@mysten/sui.js/keypairs/ed25519';\nimport { TransactionBlock } from '@mysten/sui.js/transactions';\nimport {\n\tfromB64,\n\tnormalizeStructTag,\n\tnormalizeSuiAddress,\n\tnormalizeSuiObjectId,\n\tparseStructTag,\n\tSUI_TYPE_ARG,\n\ttoB64,\n} from '@mysten/sui.js/utils';\n\nimport type { ZkSendLinkBuilderOptions } from './builder.js';\nimport { ZkSendLinkBuilder } from './builder.js';\nimport type { LinkAssets } from './utils.js';\nimport { getAssetsFromTxnBlock, isOwner, ownedAfterChange } from './utils.js';\nimport type { ZkBagContractOptions } from './zk-bag.js';\nimport { MAINNET_CONTRACT_IDS, ZkBag } from './zk-bag.js';\n\nconst DEFAULT_ZK_SEND_LINK_OPTIONS = {\n\thost: 'https://zksend.com',\n\tpath: '/claim',\n\tnetwork: 'mainnet' as const,\n};\n\nconst SUI_COIN_TYPE = normalizeStructTag(SUI_TYPE_ARG);\nconst SUI_COIN_OBJECT_TYPE = normalizeStructTag('0x2::coin::Coin<0x2::sui::SUI>');\n\nexport type ZkSendLinkOptions = {\n\tclaimApi?: string;\n\tkeypair?: Keypair;\n\tclient?: SuiClient;\n\tnetwork?: 'mainnet' | 'testnet';\n\thost?: string;\n\tpath?: string;\n\taddress?: string;\n\tisContractLink: boolean;\n\tcontract?: ZkBagContractOptions | null;\n} & (\n\t| {\n\t\t\taddress: string;\n\t\t\tkeypair?: never;\n\t  }\n\t| {\n\t\t\tkeypair: Keypair;\n\t\t\taddress?: never;\n\t  }\n);\n\nexport class ZkSendLink {\n\taddress: string;\n\tkeypair?: Keypair;\n\tcreatorAddress?: string;\n\tassets?: LinkAssets;\n\tclaimed?: boolean;\n\tbagObject?: SuiObjectData | null;\n\n\t#client: SuiClient;\n\t#contract?: ZkBag<ZkBagContractOptions>;\n\t#network: 'mainnet' | 'testnet';\n\t#host: string;\n\t#path: string;\n\t#claimApi: string;\n\n\t// State for non-contract based links\n\t#gasCoin?: CoinStruct;\n\t#hasSui = false;\n\t#ownedObjects: {\n\t\tobjectId: string;\n\t\tversion: string;\n\t\tdigest: string;\n\t\ttype: string;\n\t}[] = [];\n\n\tconstructor({\n\t\tnetwork = DEFAULT_ZK_SEND_LINK_OPTIONS.network,\n\t\tclient = new SuiClient({ url: getFullnodeUrl(network) }),\n\t\tkeypair,\n\t\tcontract = network === 'mainnet' ? MAINNET_CONTRACT_IDS : null,\n\t\taddress,\n\t\thost = DEFAULT_ZK_SEND_LINK_OPTIONS.host,\n\t\tpath = DEFAULT_ZK_SEND_LINK_OPTIONS.path,\n\t\tclaimApi = `${host}/api`,\n\t\tisContractLink,\n\t}: ZkSendLinkOptions) {\n\t\tif (!keypair && !address) {\n\t\t\tthrow new Error('Either keypair or address must be provided');\n\t\t}\n\n\t\tthis.#client = client;\n\t\tthis.keypair = keypair;\n\t\tthis.address = address ?? keypair!.toSuiAddress();\n\t\tthis.#claimApi = claimApi;\n\t\tthis.#network = network;\n\t\tthis.#host = host;\n\t\tthis.#path = path;\n\n\t\tif (isContractLink) {\n\t\t\tif (!contract) {\n\t\t\t\tthrow new Error('Contract options are required for contract based links');\n\t\t\t}\n\n\t\t\tthis.#contract = new ZkBag(contract.packageId, contract);\n\t\t}\n\t}\n\n\tstatic async fromUrl(\n\t\turl: string,\n\t\toptions: Omit<ZkSendLinkOptions, 'keypair' | 'address' | 'isContractLink'> = {},\n\t) {\n\t\tconst parsed = new URL(url);\n\t\tconst isContractLink = parsed.hash.startsWith('#$');\n\n\t\tlet link: ZkSendLink;\n\t\tif (isContractLink) {\n\t\t\tconst keypair = Ed25519Keypair.fromSecretKey(fromB64(parsed.hash.slice(2)));\n\t\t\tlink = new ZkSendLink({\n\t\t\t\t...options,\n\t\t\t\tkeypair,\n\t\t\t\thost: `${parsed.protocol}//${parsed.host}`,\n\t\t\t\tpath: parsed.pathname,\n\t\t\t\tisContractLink: true,\n\t\t\t});\n\t\t} else {\n\t\t\tconst keypair = Ed25519Keypair.fromSecretKey(\n\t\t\t\tfromB64(isContractLink ? parsed.hash.slice(2) : parsed.hash.slice(1)),\n\t\t\t);\n\n\t\t\tlink = new ZkSendLink({\n\t\t\t\t...options,\n\t\t\t\tkeypair,\n\t\t\t\thost: `${parsed.protocol}//${parsed.host}`,\n\t\t\t\tpath: parsed.pathname,\n\t\t\t\tisContractLink: false,\n\t\t\t});\n\t\t}\n\n\t\tawait link.loadAssets();\n\n\t\treturn link;\n\t}\n\n\tstatic async fromAddress(\n\t\taddress: string,\n\t\toptions: Omit<ZkSendLinkOptions, 'keypair' | 'address' | 'isContractLink'>,\n\t) {\n\t\tconst link = new ZkSendLink({\n\t\t\t...options,\n\t\t\taddress,\n\t\t\tisContractLink: true,\n\t\t});\n\n\t\tawait link.loadAssets();\n\n\t\treturn link;\n\t}\n\n\tasync loadClaimedStatus() {\n\t\tawait this.#loadBag({ loadAssets: false });\n\t}\n\n\tasync loadAssets(\n\t\toptions: {\n\t\t\ttransactionBlock?: SuiTransactionBlockResponse;\n\t\t\tloadClaimedAssets?: boolean;\n\t\t} = {},\n\t) {\n\t\tif (this.#contract) {\n\t\t\tawait this.#loadBag(options);\n\t\t} else {\n\t\t\tawait this.#loadOwnedObjects(options);\n\t\t}\n\t}\n\n\tasync claimAssets(\n\t\taddress: string,\n\t\t{\n\t\t\treclaim,\n\t\t\tsign,\n\t\t}:\n\t\t\t| { reclaim?: false; sign?: never }\n\t\t\t| {\n\t\t\t\t\treclaim: true;\n\t\t\t\t\tsign: (transactionBlock: Uint8Array) => Promise<string>;\n\t\t\t  } = {},\n\t) {\n\t\tif (!this.keypair && !sign) {\n\t\t\tthrow new Error('Cannot claim assets without links keypair');\n\t\t}\n\n\t\tif (this.claimed) {\n\t\t\tthrow new Error('Assets have already been claimed');\n\t\t}\n\n\t\tif (!this.#contract) {\n\t\t\tconst bytes = await this.createClaimTransaction(address).build({\n\t\t\t\tclient: this.#client,\n\t\t\t});\n\t\t\tconst signature = sign\n\t\t\t\t? await sign(bytes)\n\t\t\t\t: (await this.keypair!.signTransactionBlock(bytes)).signature;\n\n\t\t\treturn this.#client.executeTransactionBlock({\n\t\t\t\ttransactionBlock: bytes,\n\t\t\t\tsignature,\n\t\t\t});\n\t\t}\n\n\t\tif (!this.assets) {\n\t\t\tawait this.#loadBag();\n\t\t}\n\n\t\tconst txb = this.createClaimTransaction(address, { reclaim });\n\n\t\tconst sponsored = await this.#createSponsoredTransactionBlock(\n\t\t\ttxb,\n\t\t\taddress,\n\t\t\treclaim ? address : this.keypair!.toSuiAddress(),\n\t\t);\n\n\t\tconst bytes = fromB64(sponsored.bytes);\n\t\tconst signature = sign\n\t\t\t? await sign(bytes)\n\t\t\t: (await this.keypair!.signTransactionBlock(bytes)).signature;\n\n\t\tconst { digest } = await this.#executeSponsoredTransactionBlock(sponsored, signature);\n\n\t\treturn this.#client.waitForTransactionBlock({ digest });\n\t}\n\n\tcreateClaimTransaction(\n\t\taddress: string,\n\t\t{\n\t\t\treclaim,\n\t\t}: {\n\t\t\treclaim?: boolean;\n\t\t} = {},\n\t) {\n\t\tif (!this.#contract) {\n\t\t\treturn this.#createNonContractClaimTransaction(address);\n\t\t}\n\n\t\tif (!this.keypair && !reclaim) {\n\t\t\tthrow new Error('Cannot claim assets without the links keypair');\n\t\t}\n\n\t\tconst txb = new TransactionBlock();\n\t\tconst sender = reclaim ? address : this.keypair!.toSuiAddress();\n\t\ttxb.setSender(sender);\n\n\t\tconst store = txb.object(this.#contract.ids.bagStoreId);\n\n\t\tconst [bag, proof] = reclaim\n\t\t\t? this.#contract.reclaim(txb, { arguments: [store, this.address] })\n\t\t\t: this.#contract.init_claim(txb, { arguments: [store] });\n\n\t\tconst objectsToTransfer = [];\n\n\t\tconst objects = [...(this.assets?.coins ?? []), ...(this.assets?.nfts ?? [])];\n\n\t\tfor (const object of objects) {\n\t\t\tobjectsToTransfer.push(\n\t\t\t\tthis.#contract.claim(txb, {\n\t\t\t\t\targuments: [\n\t\t\t\t\t\tbag,\n\t\t\t\t\t\tproof,\n\t\t\t\t\t\ttxb.receivingRef({\n\t\t\t\t\t\t\tobjectId: object.objectId,\n\t\t\t\t\t\t\tversion: object.version,\n\t\t\t\t\t\t\tdigest: object.digest,\n\t\t\t\t\t\t}),\n\t\t\t\t\t],\n\t\t\t\t\ttypeArguments: [object.type],\n\t\t\t\t}),\n\t\t\t);\n\t\t}\n\n\t\tthis.#contract.finalize(txb, { arguments: [bag, proof] });\n\t\tif (objectsToTransfer.length > 0) {\n\t\t\ttxb.transferObjects(objectsToTransfer, address);\n\t\t}\n\n\t\treturn txb;\n\t}\n\n\tasync createRegenerateTransaction(\n\t\tsender: string,\n\t\toptions: Omit<ZkSendLinkBuilderOptions, 'sender'> = {},\n\t) {\n\t\tif (!this.assets) {\n\t\t\tawait this.#loadBag();\n\t\t}\n\n\t\tif (this.claimed) {\n\t\t\tthrow new Error('Assets have already been claimed');\n\t\t}\n\n\t\tif (!this.#contract) {\n\t\t\tthrow new Error('Regenerating non-contract based links is not supported');\n\t\t}\n\n\t\tconst txb = new TransactionBlock();\n\t\ttxb.setSender(sender);\n\n\t\tconst store = txb.object(this.#contract.ids.bagStoreId);\n\n\t\tconst newLinkKp = Ed25519Keypair.generate();\n\n\t\tconst newLink = new ZkSendLinkBuilder({\n\t\t\t...options,\n\t\t\tsender,\n\t\t\tclient: this.#client,\n\t\t\tcontract: this.#contract.ids,\n\t\t\thost: this.#host,\n\t\t\tpath: this.#path,\n\t\t\tkeypair: newLinkKp,\n\t\t});\n\n\t\tconst to = txb.pure.address(newLinkKp.toSuiAddress());\n\n\t\tthis.#contract.update_receiver(txb, { arguments: [store, this.address, to] });\n\n\t\treturn {\n\t\t\turl: newLink.getLink(),\n\t\t\ttransactionBlock: txb,\n\t\t};\n\t}\n\n\tasync #loadBagObject() {\n\t\tif (!this.#contract) {\n\t\t\tthrow new Error('Cannot load bag object for non-contract based links');\n\t\t}\n\t\tconst bagField = await this.#client.getDynamicFieldObject({\n\t\t\tparentId: this.#contract.ids.bagStoreTableId,\n\t\t\tname: {\n\t\t\t\ttype: 'address',\n\t\t\t\tvalue: this.address,\n\t\t\t},\n\t\t});\n\n\t\tthis.bagObject = bagField.data;\n\t\tthis.claimed = !bagField.data;\n\t}\n\n\tasync #loadBag({\n\t\ttransactionBlock,\n\t\tloadAssets = true,\n\t\tloadClaimedAssets = loadAssets,\n\t}: {\n\t\ttransactionBlock?: SuiTransactionBlockResponse;\n\t\tloadAssets?: boolean;\n\t\tloadClaimedAssets?: boolean;\n\t} = {}) {\n\t\tif (!this.#contract) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.assets = {\n\t\t\tbalances: [],\n\t\t\tnfts: [],\n\t\t\tcoins: [],\n\t\t};\n\n\t\tif (!this.bagObject || !this.claimed) {\n\t\t\tawait this.#loadBagObject();\n\t\t}\n\n\t\tif (!loadAssets) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.bagObject) {\n\t\t\tif (loadClaimedAssets) {\n\t\t\t\tawait this.#loadClaimedAssets();\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\tconst bagId = (this.bagObject as any).content.fields.value.fields?.id?.id;\n\n\t\tif (bagId && transactionBlock?.balanceChanges && transactionBlock.objectChanges) {\n\t\t\tthis.assets = getAssetsFromTxnBlock({\n\t\t\t\ttransactionBlock,\n\t\t\t\taddress: bagId,\n\t\t\t\tisSent: false,\n\t\t\t});\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst itemIds: string[] | undefined = (this.bagObject as any)?.content?.fields?.value?.fields\n\t\t\t?.item_ids.fields.contents;\n\n\t\tthis.creatorAddress = (this.bagObject as any)?.content?.fields?.value?.fields?.owner;\n\n\t\tif (!itemIds) {\n\t\t\tthrow new Error('Invalid bag field');\n\t\t}\n\n\t\tconst objectsResponse = await this.#client.multiGetObjects({\n\t\t\tids: itemIds,\n\t\t\toptions: {\n\t\t\t\tshowType: true,\n\t\t\t\tshowContent: true,\n\t\t\t},\n\t\t});\n\n\t\tconst balances = new Map<\n\t\t\tstring,\n\t\t\t{\n\t\t\t\tcoinType: string;\n\t\t\t\tamount: bigint;\n\t\t\t}\n\t\t>();\n\n\t\tobjectsResponse.forEach((object, i) => {\n\t\t\tif (!object.data || !object.data.type) {\n\t\t\t\tthrow new Error(`Failed to load claimable object ${itemIds[i]}`);\n\t\t\t}\n\n\t\t\tconst type = parseStructTag(normalizeStructTag(object.data.type));\n\n\t\t\tif (\n\t\t\t\ttype.address === normalizeSuiAddress('0x2') &&\n\t\t\t\ttype.module === 'coin' &&\n\t\t\t\ttype.name === 'Coin'\n\t\t\t) {\n\t\t\t\tthis.assets!.coins.push({\n\t\t\t\t\tobjectId: object.data.objectId,\n\t\t\t\t\ttype: object.data.type,\n\t\t\t\t\tversion: object.data.version,\n\t\t\t\t\tdigest: object.data.digest,\n\t\t\t\t});\n\n\t\t\t\tif (object.data.content?.dataType === 'moveObject') {\n\t\t\t\t\tconst amount = BigInt((object.data.content.fields as Record<string, string>).balance);\n\t\t\t\t\tconst coinType = normalizeStructTag(\n\t\t\t\t\t\tparseStructTag(object.data.content.type).typeParams[0],\n\t\t\t\t\t);\n\t\t\t\t\tif (!balances.has(coinType)) {\n\t\t\t\t\t\tbalances.set(coinType, { coinType, amount });\n\t\t\t\t\t} else {\n\t\t\t\t\t\tbalances.get(coinType)!.amount += amount;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.assets!.nfts.push({\n\t\t\t\t\tobjectId: object.data.objectId,\n\t\t\t\t\ttype: object.data.type,\n\t\t\t\t\tversion: object.data.version,\n\t\t\t\t\tdigest: object.data.digest,\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\tthis.assets.balances = [...balances.values()];\n\t}\n\n\tasync #loadClaimedAssets() {\n\t\tconst result = await this.#client.queryTransactionBlocks({\n\t\t\tlimit: 1,\n\t\t\tfilter: {\n\t\t\t\tFromAddress: this.address,\n\t\t\t},\n\t\t\toptions: {\n\t\t\t\tshowObjectChanges: true,\n\t\t\t\tshowBalanceChanges: true,\n\t\t\t\tshowInput: true,\n\t\t\t},\n\t\t});\n\n\t\tif (!result?.data[0]) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst [txb] = result.data;\n\n\t\tif (txb.transaction?.data.transaction.kind !== 'ProgrammableTransaction') {\n\t\t\treturn;\n\t\t}\n\n\t\tconst transfer = txb.transaction.data.transaction.transactions.findLast(\n\t\t\t(tx): tx is Extract<SuiTransaction, { TransferObjects: unknown }> => 'TransferObjects' in tx,\n\t\t);\n\n\t\tif (!transfer) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst receiverArg = transfer.TransferObjects[1];\n\n\t\tif (!(typeof receiverArg === 'object' && 'Input' in receiverArg)) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst input = txb.transaction.data.transaction.inputs[receiverArg.Input];\n\n\t\tif (input.type !== 'pure') {\n\t\t\treturn;\n\t\t}\n\n\t\tconst receiver =\n\t\t\ttypeof input.value === 'string'\n\t\t\t\t? input.value\n\t\t\t\t: bcs.Address.parse(new Uint8Array((input.value as PureArg).Pure));\n\n\t\tthis.assets = getAssetsFromTxnBlock({\n\t\t\ttransactionBlock: txb,\n\t\t\taddress: receiver,\n\t\t\tisSent: false,\n\t\t});\n\t}\n\n\tasync #createSponsoredTransactionBlock(txb: TransactionBlock, claimer: string, sender: string) {\n\t\treturn this.#fetch<{ digest: string; bytes: string }>('transaction-blocks/sponsor', {\n\t\t\tmethod: 'POST',\n\t\t\tbody: JSON.stringify({\n\t\t\t\tnetwork: this.#network,\n\t\t\t\tsender,\n\t\t\t\tclaimer,\n\t\t\t\ttransactionBlockKindBytes: toB64(\n\t\t\t\t\tawait txb.build({\n\t\t\t\t\t\tonlyTransactionKind: true,\n\t\t\t\t\t\tclient: this.#client,\n\t\t\t\t\t\t// Theses limits will get verified during the final transaction construction, so we can safely ignore them here:\n\t\t\t\t\t\tlimits: {\n\t\t\t\t\t\t\tmaxGasObjects: Infinity,\n\t\t\t\t\t\t\tmaxPureArgumentSize: Infinity,\n\t\t\t\t\t\t\tmaxTxGas: Infinity,\n\t\t\t\t\t\t\tmaxTxSizeBytes: Infinity,\n\t\t\t\t\t\t},\n\t\t\t\t\t}),\n\t\t\t\t),\n\t\t\t}),\n\t\t});\n\t}\n\n\tasync #executeSponsoredTransactionBlock(\n\t\tinput: { digest: string; bytes: string },\n\t\tsignature: string,\n\t) {\n\t\treturn this.#fetch<{ digest: string }>(`transaction-blocks/sponsor/${input.digest}`, {\n\t\t\tmethod: 'POST',\n\t\t\tbody: JSON.stringify({\n\t\t\t\tsignature,\n\t\t\t}),\n\t\t});\n\t}\n\n\tasync #fetch<T = unknown>(path: string, init: RequestInit): Promise<T> {\n\t\tconst res = await fetch(`${this.#claimApi}/v1/${path}`, {\n\t\t\t...init,\n\t\t\theaders: {\n\t\t\t\t...init.headers,\n\t\t\t\t'Content-Type': 'application/json',\n\t\t\t},\n\t\t});\n\n\t\tif (!res.ok) {\n\t\t\tconsole.error(await res.text());\n\t\t\tthrow new Error(`Request to claim API failed with status code ${res.status}`);\n\t\t}\n\n\t\tconst { data } = await res.json();\n\n\t\treturn data as T;\n\t}\n\n\tasync #listNonContractClaimableAssets() {\n\t\tconst balances: {\n\t\t\tcoinType: string;\n\t\t\tamount: bigint;\n\t\t}[] = [];\n\n\t\tconst nfts: {\n\t\t\tobjectId: string;\n\t\t\ttype: string;\n\t\t\tversion: string;\n\t\t\tdigest: string;\n\t\t}[] = [];\n\n\t\tconst coins: {\n\t\t\tobjectId: string;\n\t\t\ttype: string;\n\t\t\tversion: string;\n\t\t\tdigest: string;\n\t\t}[] = [];\n\n\t\tif (this.#ownedObjects.length === 0 && !this.#hasSui) {\n\t\t\treturn {\n\t\t\t\tbalances,\n\t\t\t\tnfts,\n\t\t\t\tcoins,\n\t\t\t};\n\t\t}\n\n\t\tconst address = new Ed25519Keypair().toSuiAddress();\n\t\tconst normalizedAddress = normalizeSuiAddress(address);\n\n\t\tconst txb = this.createClaimTransaction(normalizedAddress);\n\n\t\tif (this.#gasCoin || !this.#hasSui) {\n\t\t\ttxb.setGasPayment([]);\n\t\t}\n\n\t\tconst dryRun = await this.#client.dryRunTransactionBlock({\n\t\t\ttransactionBlock: await txb.build({ client: this.#client }),\n\t\t});\n\n\t\tdryRun.balanceChanges.forEach((balanceChange) => {\n\t\t\tif (BigInt(balanceChange.amount) > 0n && isOwner(balanceChange.owner, normalizedAddress)) {\n\t\t\t\tbalances.push({\n\t\t\t\t\tcoinType: normalizeStructTag(balanceChange.coinType),\n\t\t\t\t\tamount: BigInt(balanceChange.amount),\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\tdryRun.objectChanges.forEach((objectChange) => {\n\t\t\tif ('objectType' in objectChange) {\n\t\t\t\tconst type = parseStructTag(objectChange.objectType);\n\n\t\t\t\tif (\n\t\t\t\t\ttype.address === normalizeSuiAddress('0x2') &&\n\t\t\t\t\ttype.module === 'coin' &&\n\t\t\t\t\ttype.name === 'Coin'\n\t\t\t\t) {\n\t\t\t\t\tif (ownedAfterChange(objectChange, normalizedAddress)) {\n\t\t\t\t\t\tcoins.push(objectChange);\n\t\t\t\t\t}\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (ownedAfterChange(objectChange, normalizedAddress)) {\n\t\t\t\tnfts.push(objectChange);\n\t\t\t}\n\t\t});\n\n\t\treturn {\n\t\t\tbalances,\n\t\t\tnfts,\n\t\t\tcoins,\n\t\t};\n\t}\n\n\t#createNonContractClaimTransaction(address: string) {\n\t\tif (!this.keypair) {\n\t\t\tthrow new Error('Cannot claim assets without the links keypair');\n\t\t}\n\n\t\tconst txb = new TransactionBlock();\n\t\ttxb.setSender(this.keypair.toSuiAddress());\n\n\t\tconst objectsToTransfer = this.#ownedObjects\n\t\t\t.filter((object) => {\n\t\t\t\tif (this.#gasCoin) {\n\t\t\t\t\tif (object.objectId === this.#gasCoin.coinObjectId) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t} else if (object.type === SUI_COIN_OBJECT_TYPE) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t})\n\t\t\t.map((object) => txb.object(object.objectId));\n\n\t\tif (this.#gasCoin && this.creatorAddress) {\n\t\t\ttxb.transferObjects([txb.gas], this.creatorAddress);\n\t\t} else {\n\t\t\tobjectsToTransfer.push(txb.gas);\n\t\t}\n\n\t\tif (objectsToTransfer.length > 0) {\n\t\t\ttxb.transferObjects(objectsToTransfer, address);\n\t\t}\n\n\t\treturn txb;\n\t}\n\n\tasync #loadOwnedObjects({\n\t\tloadClaimedAssets = true,\n\t}: {\n\t\tloadClaimedAssets?: boolean;\n\t} = {}) {\n\t\tthis.assets = {\n\t\t\tnfts: [],\n\t\t\tbalances: [],\n\t\t\tcoins: [],\n\t\t};\n\n\t\tlet nextCursor: string | null | undefined;\n\t\tdo {\n\t\t\tconst ownedObjects = await this.#client.getOwnedObjects({\n\t\t\t\tcursor: nextCursor,\n\t\t\t\towner: this.address,\n\t\t\t\toptions: {\n\t\t\t\t\tshowType: true,\n\t\t\t\t\tshowContent: true,\n\t\t\t\t},\n\t\t\t});\n\n\t\t\t// RPC response returns cursor even if there are no more pages\n\t\t\tnextCursor = ownedObjects.hasNextPage ? ownedObjects.nextCursor : null;\n\t\t\tfor (const object of ownedObjects.data) {\n\t\t\t\tif (object.data) {\n\t\t\t\t\tthis.#ownedObjects.push({\n\t\t\t\t\t\tobjectId: normalizeSuiObjectId(object.data.objectId),\n\t\t\t\t\t\tversion: object.data.version,\n\t\t\t\t\t\tdigest: object.data.digest,\n\t\t\t\t\t\ttype: normalizeStructTag(object.data.type!),\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t} while (nextCursor);\n\n\t\tconst coins = await this.#client.getCoins({\n\t\t\tcoinType: SUI_COIN_TYPE,\n\t\t\towner: this.address,\n\t\t});\n\n\t\tthis.#hasSui = coins.data.length > 0;\n\t\tthis.#gasCoin = coins.data.find((coin) => BigInt(coin.balance) % 1000n === 987n);\n\n\t\tconst result = await this.#client.queryTransactionBlocks({\n\t\t\tlimit: 1,\n\t\t\torder: 'ascending',\n\t\t\tfilter: {\n\t\t\t\tToAddress: this.address,\n\t\t\t},\n\t\t\toptions: {\n\t\t\t\tshowInput: true,\n\t\t\t\tshowBalanceChanges: true,\n\t\t\t\tshowObjectChanges: true,\n\t\t\t},\n\t\t});\n\n\t\tthis.creatorAddress = result.data[0]?.transaction?.data.sender;\n\n\t\tif (this.#hasSui || this.#ownedObjects.length > 0) {\n\t\t\tthis.claimed = false;\n\t\t\tthis.assets = await this.#listNonContractClaimableAssets();\n\t\t} else if (result.data[0] && loadClaimedAssets) {\n\t\t\tthis.claimed = true;\n\t\t\tawait this.#loadClaimedAssets();\n\t\t}\n\t}\n}\n"],
  "mappings": "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",
  "names": ["bytes", "signature"]
}
